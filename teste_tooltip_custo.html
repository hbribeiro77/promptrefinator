<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Tooltip de Custo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Teste - Tooltip de Memória de Cálculo</h2>
        <div class="card">
            <div class="card-body">
                <h5>Exemplo de Custo com Tooltip</h5>
                <p>
                    Custo da análise: $0.001250
                    <i class="bi bi-info-circle text-muted ms-1 custo-info-icon" 
                       style="cursor: pointer; font-size: 0.8em;" 
                       data-bs-toggle="tooltip" 
                       data-bs-placement="top" 
                       data-bs-html="true"
                       data-modelo="gpt-4o"
                       data-tokens-input="500"
                       data-tokens-output="100"
                       data-custo-real="0.001250"
                       data-provider="OpenAI"></i>
                </p>
                
                <p>
                    Custo da análise 2: $0.000075
                    <i class="bi bi-info-circle text-muted ms-1 custo-info-icon" 
                       style="cursor: pointer; font-size: 0.8em;" 
                       data-bs-toggle="tooltip" 
                       data-bs-placement="top" 
                       data-bs-html="true"
                       data-modelo="gpt-4o-mini"
                       data-tokens-input="300"
                       data-tokens-output="200"
                       data-custo-real="0.000075"
                       data-provider="OpenAI"></i>
                </p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Preços dos modelos (simulando dados do backend para teste)
        const PRECOS_MODELOS = {
            'openai': {
                'gpt-4o': { input: 2.50, output: 10.00 },
                'gpt-4o-mini': { input: 0.15, output: 0.60 },
                'gpt-4-turbo': { input: 10.00, output: 30.00 },
                'gpt-3.5-turbo': { input: 0.50, output: 1.50 }
            },
            'azure': {
                'gpt-4o': { input: 5.00, output: 15.00 },
                'gpt-4o-mini': { input: 0.165, output: 0.66 },
                'gpt-4-turbo': { input: 10.00, output: 30.00 },
                'gpt-3.5-turbo': { input: 0.50, output: 1.50 }
            }
        };

        // Função para obter preços do modelo baseado no provedor
        function obterPrecosModelo(modelo, provider = 'OpenAI') {
            const modeloLower = modelo.toLowerCase();
            
            // Mapeamento de nomes de modelos
            const mapeamento = {
                'gpt4o': 'gpt-4o',
                'gpt-4o': 'gpt-4o',
                'gpt4o-mini': 'gpt-4o-mini',
                'gpt-4o-mini': 'gpt-4o-mini',
                'gpt4-turbo': 'gpt-4-turbo',
                'gpt-4-turbo': 'gpt-4-turbo',
                'gpt-4-turbo-preview': 'gpt-4-turbo',
                'gpt35-turbo': 'gpt-3.5-turbo',
                'gpt-35-turbo': 'gpt-3.5-turbo',
                'gpt-3.5-turbo': 'gpt-3.5-turbo',
                'gpt-4': 'gpt-4-turbo' // Mapear gpt-4 para gpt-4-turbo
            };
            
            const chaveModelo = mapeamento[modeloLower] || 'gpt-4o'; // Default para gpt-4o
            
            // Determinar qual conjunto de preços usar baseado no provedor
            const providerKey = provider.toLowerCase().includes('azure') ? 'azure' : 'openai';
            const precosProvider = PRECOS_MODELOS[providerKey];
            
            // Retornar preços do modelo ou padrão
            return precosProvider[chaveModelo] || precosProvider['gpt-4o'] || { input: 2.50, output: 10.00 };
        }

        // Função para gerar tooltip de memória de cálculo
        function gerarTooltipMemoriaCalculo(elemento) {
            const modelo = elemento.dataset.modelo || 'gpt-4o';
            const tokensInput = parseInt(elemento.dataset.tokensInput) || 0;
            const tokensOutput = parseInt(elemento.dataset.tokensOutput) || 0;
            const custoReal = parseFloat(elemento.dataset.custoReal) || 0;
            const provider = elemento.dataset.provider || 'OpenAI'; // Obter provider dos dados
            
            const precos = obterPrecosModelo(modelo, provider);
            
            // Calcular custos individuais (preços são por 1M tokens)
            const custoInput = (tokensInput / 1000000) * precos.input;
            const custoOutput = (tokensOutput / 1000000) * precos.output;
            
            return `<strong>Memória de Cálculo:</strong><br>
                    Provider: ${provider}<br>
                    Modelo: ${modelo}<br>
                    Tokens Input: ${tokensInput.toLocaleString()}<br>
                    Tokens Output: ${tokensOutput.toLocaleString()}<br>
                    <hr style='margin: 4px 0;'>
                    Preço Input: $${precos.input.toFixed(3)}/1M tokens<br>
                    Preço Output: $${precos.output.toFixed(3)}/1M tokens<br>
                    <hr style='margin: 4px 0;'>
                    Custo Input: $${custoInput.toFixed(6)}<br>
                    Custo Output: $${custoOutput.toFixed(6)}<br>
                    <strong>Total: $${custoReal.toFixed(6)}</strong>`;
        }

        // Inicializar tooltips
        document.addEventListener('DOMContentLoaded', function() {
            const custoIcons = document.querySelectorAll('.custo-info-icon');
            custoIcons.forEach(icon => {
                const tooltipContent = gerarTooltipMemoriaCalculo(icon);
                icon.setAttribute('title', tooltipContent);
            });
            
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl, {
                    html: true,
                    delay: { show: 300, hide: 100 }
                });
            });
            
            console.log(`Inicializados ${tooltipList.length} tooltips`);
        });
    </script>
</body>
</html>